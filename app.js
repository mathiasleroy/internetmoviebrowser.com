const router=new VueRouter({routes:[{path:"/",alias:"/home",name:"movielist",component:httpVueLoader("pages/movielist.vue")},{path:"/about",alias:"/ab",name:"about",component:httpVueLoader("pages/about.vue")},{path:"/settings",alias:"/s",name:"settings",component:httpVueLoader("pages/settings.vue")},{path:"/account",alias:"/ac",name:"account",component:httpVueLoader("pages/account.vue")},{path:"/m/:imdbID",alias:"/movie/:imdbID",name:"oneMovie",component:httpVueLoader("pages/moviedetails.vue")}]}),thisYear=(new Date).getFullYear(),ranges={year:[1960,thisYear+1,1],month:[1,12],day:[1,31],score:[0,100,1],votes:[0,1e6,10],runtime:[0,180,5],imdb:[1,10,.1],rt:[0,100,1],mc:[0,100,1],lbxd:[0,5,.1]},inits={year:[2017,thisYear+1],month:[1,1],day:[1,1],score:[ranges.score[0],ranges.score[1]],votes:[ranges.votes[0],ranges.votes[1]],runtime:[ranges.runtime[0],ranges.runtime[1]]};var app=new Vue({el:"#app",router:router,vuetify:new Vuetify,components:{mynavbar:httpVueLoader("components/navbar.vue"),mybottomnav:httpVueLoader("components/bottomnav.vue"),mybottomnav:httpVueLoader("components/bottomnav.vue"),accountmechanics:httpVueLoader("components/accountmechanics.vue")},data:()=>({movies_n:1e4,n_movies_viewable:0,movies_listids:[],movies_dict:{},genres_dict:{},genres_list:[],pagination:{currentPage:1,moviesPerPage:20},tresholds:{global:[73,63,54,44],imdb:[73,63,54,44].map((e=>Math.round(9*e/10/10*1e3)/1e3+1)),rt:[73,63,54,44],mc:[73,63,54,44],lbxd:[73,63,54,44].map((e=>e/20))},selectSort:"Rank",selectSearch:"",selectView:"all",selects:{year:inits.year.slice(),month:inits.month.slice(),day:inits.day.slice(),score:inits.score.slice(),votes:inits.votes.slice(),runtime:inits.runtime.slice(),dvd:!1,genre_list:[]},goDark:!1,isLoading:!0,options:{_1337x:!0},user:{},presets:[{title:"Best last 3 months",name:"best3m"},{title:"Best last 2 years",name:"best2y"},{title:"Trending Good",name:"trendinggood"},{title:"Unkown Gems",name:"unknowngems"},{title:"Good Classics",name:"goodclassics"}],setPreset:null}),computed:{hasFilterActive(){return 0!=this.selects.dvd||this.selects.year[0]!=ranges.year[0]||this.selects.year[1]!=ranges.year[1]||this.selects.month[0]!=inits.month[0]||this.selects.month[1]!=inits.month[1]||this.selects.day[0]!=inits.day[0]||this.selects.day[1]!=inits.day[1]||this.selects.score[0]!=ranges.score[0]||this.selects.score[1]!=ranges.score[1]||this.selects.votes[0]!=ranges.votes[0]||this.selects.votes[1]!=ranges.votes[1]||this.selects.runtime[0]!=ranges.runtime[0]||this.selects.runtime[1]!=ranges.runtime[1]||this.selects.genre_list.length}},mounted(){var e=this;(new Date).getHours()>=20&&(this.goDark=!0),window.location.hash.indexOf("n=30k")>-1||window.location.hash.indexOf("n=30000")>-1?e.movies_n=3e4:window.location.hash.indexOf("n=10k")>-1||window.location.hash.indexOf("n=10000")>-1?e.movies_n=1e4:window.location.hash.indexOf("n=1k")>-1||window.location.hash.indexOf("n=1000")>-1?e.movies_n=1e3:window.location.hash.indexOf("n=100")>-1&&(e.movies_n=100),e.movies_n>10&&e.loadMovies_fb_sto(100),e.movies_n>100&&e.loadMovies_fb_sto(1e3),e.movies_n>1e3&&e.loadMovies_fb_sto(1e4),e.movies_n>1e4&&e.loadMovies_fb_sto(3e4)},watch:{goDark:function(e,t){this.$vuetify.theme.dark=e},selectSearch:function(e,t){e&&e.length>1&&"movielist"!=this.$route.name&&router.push("/"),this.pagination.currentPage=1}},methods:{clearFilters(){this.selects.dvd=!1,this.selects.genre_list=[],this.selects.year=[ranges.year[0],ranges.year[1]],this.selects.month=inits.month.slice(),this.selects.day=inits.day.slice(),this.selects.score=[ranges.score[0],ranges.score[1]],this.selects.votes=[ranges.votes[0],ranges.votes[1]],this.selects.runtime=[ranges.runtime[0],ranges.runtime[1]]},searchQuoted(e,t){this.selectSearch=t?t+":'"+e+"'":"'"+e+"'"},logout(){let e=this;firebase.auth().signOut().then((function(){e.user=null,e.user={},console.log("logout complete")}),(function(e){console.log("logout error: ",e)}))},toggleUserList(e,t){if(this.user.uid){if(t)if(accountRef=db.collection("accounts").doc(this.user.uid),"watchlist"==e)(s=this.user.uWatchList.indexOf(t))<0?(this.user.uWatchList.push(t),accountRef.update({WatchList:firebase.firestore.FieldValue.arrayUnion(t)})):(this.user.uWatchList.splice(s,1),accountRef.update({WatchList:firebase.firestore.FieldValue.arrayRemove(t)}));else if("favlist"==e){var s;(s=this.user.uFavsList.indexOf(t))<0?(this.user.uFavsList.push(t),accountRef.update({FavsList:firebase.firestore.FieldValue.arrayUnion(t)})):(this.user.uFavsList.splice(s,1),accountRef.update({FavsList:firebase.firestore.FieldValue.arrayRemove(t)}))}}else router.push("/account")},loadMovies_fb_sto(e){var t=this;let s=performance.now();var o=["https://rryperse.sirv.com/data/","https://phystrop.sirv.com/data/","https://tionergi.sirv.com/data/","https://perigato.sirv.com/data/","https://sionnics.sirv.com/data/","https://oholleep.sirv.com/data/","https://mathma.sirv.com/data/"],a=o[Math.floor(Math.random()*o.length)];Papa.parse(a+"movies-v4.2.0-i"+e+".csv",{download:!0,header:!0,dynamicTyping:!0,complete:function(o){perf(s,"Load "+e+" movies"),setTimeout((function(){o.data.splice(-1,1),o.data.map(((e,s)=>{t.dataprep(e),t.movies_dict[e.imdbID]=e,t.movies_listids.push(e.imdbID),e.Genre.split(", ").map((e=>{t.genres_dict[e]=t.genres_dict[e]+1||1})),t.genres_list=Object.keys(t.genres_dict),t.genres_list=t.genres_list.sort(((e,s)=>t.genres_dict[s]-t.genres_dict[e]))})),t.movies_listids=uniq(t.movies_listids)}),10)}})},dataprep(e){"NOT RATED"!=e.Rated&&e.Rated&&"UNRATED"!=e.Rated?"APPROVED"==e.Rated||"G"==e.Rated||"PASSED"==e.Rated||"TV-G"==e.Rated?e.Rated="MPAA-G":"R"==e.Rated?e.Rated="MPAA-R":"PG"==e.Rated||"TV-PG"==e.Rated||"M/PG"==e.Rated?e.Rated="MPAA-PG":"PG-13"==e.Rated?e.Rated="MPAA-PG-13":"NC-17"==e.Rated&&(e.Rated="MPAA-NC-17"):e.Rated="",e.metacriticURL="https://www.metacritic.com/search/movie/"+e.Title+"/results?sort=relevancy",e.TomatoURL?e.TomatoURL="http://www.rottentomatoes.com/m/"+e.TomatoURL:e.TomatoURL="https://www.rottentomatoes.com/search/?search="+e.Title,e.date=new Date(e.ReleaseDate),new Date(e.DVD)<e.date&&(e.DVD=null);var t,s=[],o=[],a=[];e.Rating_imdb&&(t=Math.round(100*(e.Rating_imdb-1)/9*100)/100,s.push(t),a.push(t)),e.Rating_rt&&(t=e.Rating_rt,s.push(t),o.push(t)),e.Rating_mc&&(t=e.Rating_mc,s.push(t),o.push(t)),e.Rating_lbxd&&(t=Math.round(100*(2*e.Rating_lbxd-1)/9*100)/100,s.push(t),a.push(t));var i=1,n=0;count=s.length;for(var r=count;r--;)i*=s[r],n+=s[r];var c=Math.round(1e3*Math.pow(i,1/count))/1e3;isNaN(c)&&(c=0);var l=Math.round(n/count*1e3)/1e3;isNaN(l)&&(l=0);var u=missingPenality*(4-count);e.GlobalScore=Math.round(100*((c+l)/2-u))/100,e.GlobalScore<=0&&(e.GlobalScore=1e-4),o.length>0?e.CriticsScore=averageF([averageF(o),geomAvgF(o)]):e.CriticsScore=0,a.length>0?e.PopularScore=averageF([averageF(a),geomAvgF(a)]):e.PopularScore=0,e.DivisionScore=0,count>1&&(e.DivisionScore=s.stanDeviate()),e.Votes=averageF([averageF([e.Votes_imdb,e.Votes_lbxd]),geomAvgF([e.Votes_imdb,e.Votes_lbxd])]),e.Votes<data_votes_range[0]&&(data_votes_range[0]=e.Votes),e.Votes>data_votes_range[1]&&(data_votes_range[1]=e.Votes),e.Director&&(e.Director=e.Director.split(", "),e.Director=uniq(e.Director),e.Director=e.Director.join(", ")),e.Genre||(e.Genre="")}}}),precachePostersList=[];let data_votes_range=[999999,0];const missingPenality=4;let search_timeout,debounce_timeout,debounce_time=500;const averageF=e=>Math.round(e.reduce(((e,t)=>e+t))/e.length*100)/100,geomAvgF=e=>Math.pow(e.reduce(((e,t)=>e*t)),1/e.length),uniq=e=>[...new Set(e)];function replacei(e,t,s){let o=e.toLowerCase().split(t.toLowerCase()),a=[],i=0;for(let n=0;n<o.length;n++){let r=o[n].length;a.push(e.substr(i,r)),n<o.length-1&&a.push(s(e.substr(i+r,t.length))),i+=r+t.length}return a.join("")}Array.prototype.stanDeviate=function(){var e,t,s,o=0,a=[];for(e=0;e<this.length;e+=1)o+=this[e];for(s=o/this.length,t=0;t<this.length;t+=1)a.push(Math.pow(this[t]-s,2));return Math.sqrt(a.reduce((function(e,t){return e+t}))/this.length)};var _doPerf=0,_doLog=0;function perf(e,t=""){if(_doPerf){let s="background: #eee; color: green",o=Math.round(100*(performance.now()-e))/100;o<10?s="background: #eee; color: #aaa":o>500?s="background: #eee; color: red":o>200&&(s="background: #eee; color: OrangeRed "),console.log("%c"+t+" took "+o+" ms",s)}}function ll(){if(_doLog){var e=Array.prototype.slice.call(arguments);text=e.join(" "),console.log(text)}}function pad(e,t,s){return s=s||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(s)+e}(location.hostname.indexOf(".c9users.io")>-1||location.hostname.indexOf(".amazonaws.com")>-1)&&(_doPerf=1,_doLog=1),Vue.filter("tofixed1",(function(e){return e?(+e).toFixed(1):"/"})),Vue.filter("tofixed0",(function(e){return e?e.toFixed(0):"/"})),Vue.filter("toThousands",(function(e){var t=new Intl.NumberFormat;return e?t.format(e.toFixed(0)):"/"})),Vue.filter("toIsoDate",(function(e){return e?new Date(e).toISOString().split("T")[0]:"/"})),Vue.filter("toFriendlyDate",(function(e){if(!e)return"/";return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})),Vue.filter("toFriendlyMpaa",(function(e){return"MPAA-G"==e?e="G: General audiences":"MPAA-PG"==e?e="PG: Parental guidance suggested":"MPAA-PG-13"==e?e="PG-13: Parents strongly cautioned":"MPAA-R"==e?e="R: Restricted":"MPAA-NC-17"==e&&(e="NC-17: No one 17 and under admitted"),e})),Vue.filter("toHHmm",(function(e){if(!e)return"/";var t=e%60;return(e-t)/60+"h "+pad(t,2)+"m"}));